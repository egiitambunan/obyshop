<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Obi Shop</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- CSS -->
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <a href="#" class="navbar-logo">Obi<span>Shop</span>.</a>
    <div class="navbar-nav">
      <a href="#">Home</a>
      <a href="#about">Tentang Kami</a>
      <div class="dropdown">
        <a href="#">Menu</a>
        <div class="dropdown-content">
          <a href="kategori.html?kategori=Aksesoris">Aksesoris</a>
          <a href="kategori.html?kategori=Aksesoris HP">Aksesoris HP</a>
          <a href="kategori.html?kategori=Gelang">Gelang</a>
          <a href="kategori.html?kategori=Gantungan Kunci">Gantungan Kunci</a>
          <a href="kategori.html?kategori=Charger">Charger</a>
          <a href="kategori.html?kategori=Mainan">Mainan</a>
        </div>
      </div>
      <a href="#contact">Kontak</a>
    </div>
    <div class="navbar-extra">
      <input type="text" id="searchInput" placeholder="Cari produk..." />
      <button id="searchBtn"><i class="fas fa-search"></i></button>
      <a href="cart.html" id="shopping-cart">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
      </a>
      <a href="#" id="Aksesoris-menu"><i class="fas fa-bars"></i></a>
    </div>
  </nav>

  <!-- Hero -->
  <section class="hero" id="home">
    <main class="content">
      <h1 id="hero-title">Mari Lihat <span>Toko Kami</span></h1>
      <p id="hero-subtitle">Temukan berbagai aksesoris wanita dan aksesoris HP yang stylish dan berkualitas untuk melengkapi penampilan dan gadget Anda.</p>
      <a href="#menu" class="Home">Beli Sekarang</a>
    </main>
  </section>

  <!-- About -->
<section id="about" class="about-new">
  <div class="container">
    <h2 class="section-title">Tentang <span>ObiShop</span></h2>
    <p id="about-text"></p>
    <div class="about-grid">
      <div class="about-card scroll-animate">
          <div class="video-wrapper" id="videoWrapper1"></div>
        <div class="about-info">
          <h3 id="title1">Video Toko Kami</h3>
          <p id="desc1">Menampilkan suasana dan kepercayaan toko ObiShop...</p>
        </div>
      </div>

      <div class="about-card scroll-animate">
          <div class="video-wrapper" id="videoWrapper2"></div>
        <div class="about-info">
          <h3 id="title2">Produk Unggulan</h3>
          <p id="desc2">Menampilkan produk-produk aksesoris pilihan...</p>
        </div>
      </div>

      <div class="about-card scroll-animate">
          <div class="video-wrapper" id="videoWrapper3"></div>
        <div class="about-info">
          <h3 id="title3">Produk Baru</h3>
          <p id="desc3">Produk baru toko kami...</p>
        </div>
      </div>
    </div>
  </div>
</section>

  <!-- Menu -->
  <section id="menu" class="menu">
    <h2><span>Menu</span> Kami</h2>
    <p>Temukan berbagai pilihan terbaik dari produk unggulan kami...</p>
    <div class="row" id="produk-terbaru"></div>
  </section>

  <!-- Contact -->
  <section id="contact" class="contact">
    <h2><span>Kontak</span> Kami</h2>
    <p>Hubungi kami melalui peta atau langsung lewat WhatsApp...</p>
    <div class="row contact-container">
      <div class="map-container">
     <iframe 
  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d31862.976493889306!2d99.39073955!3d3.38142355!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3033e8228af9ba4f%3A0xc85fff038468603!2sMedang%2C%20Kec.%20Medang%20Deras%2C%20Kabupaten%20Batu%20Bara%2C%20Sumatera%20Utara!5e0!3m2!1sid!2sid!4v1751613845197!5m2!1sid!2sid" 
  width="100%" height="300" style="border:0;" 
  allowfullscreen="" loading="lazy" 
  referrerpolicy="no-referrer-when-downgrade">
</iframe>
</div>
      <div class="contact-info-box">
        <h3>Obi Shop</h3>
        <p><i class="fas fa-map-marker-alt"></i> <span id="contact-address">Deras, Batu Bara, Sumut</span></p>
        <p><i class="fas fa-phone"></i> <a id="contact-phone" href="https://wa.me/6281234567890">+62 812-3456-7890</a></p>
        <p><i class="fas fa-envelope"></i> <a id="contact-email" href="mailto:tokoonline@obishop.id">tokoonline@obishop.id</a></p>
        <p><i class="fas fa-clock"></i> <span id="contact-clock">Senin - Sabtu, 09.00 - 17.00 WIB</span></p>
        <a href="https://wa.me/6281234567890?text=Halo%20saya%20ingin%20bertanya..." target="_blank" class="cta">Hubungi via WhatsApp</a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="socials">
      <a href="https://www.instagram.com/tokoobieshop_25" target="_blank"><i class="fab fa-instagram"></i></a>
      <a href="https://www.facebook.com/profil.php" target="_blank"><i class="fab fa-facebook"></i></a>
      <a href="https://www.tiktok.com/@oby_shop" class="tiktok" target="_blank"><i class="fab fa-tiktok"></i></a>
    </div>
    <div class="links">
      <a href="#home">Home</a>
      <a href="#about">Tentang Kami</a>
      <a href="#menu">Menu</a>
      <a href="#contact">Kontak</a>
    </div>
    <div class="credit">
      <p>Created by <a href="#">virna,egii</a>. | &copy; 2025.</p>
    </div>
  </footer>

  <!-- WA Bubble -->
  <div class="wa-bubble" id="waBubble">
    <a href="#" class="wa-icon" onclick="toggleWaMenu(event)" aria-label="Chat WhatsApp">
      <i class="fab fa-whatsapp"></i>
    </a>
    <div class="wa-options" id="waOptions">
      <div onclick="kirimPesan('Halo, saya ingin tanya tentang aksesoris HP.')">üì± Aksesoris HP</div>
      <div onclick="kirimPesan('Halo, saya tertarik aksesoris wanita, bisa info?')">üëú Aksesoris Wanita</div>
      <div onclick="kirimPesan('Ada stok gantungan kunci karakter?')">üîë Gantungan Kunci</div>
      <hr style="border-color: #333" />
      <div onclick="kirimPesan('Halo, saya ingin pesan produk. Nama:\nAlamat:\nProduk:')">üìù Form Pemesanan</div>
    </div>
  </div>
  <!-- Modal Preview Video -->
<div id="videoModal" class="modal-video">
  <div class="modal-content">
    <span class="modal-close" onclick="tutupModalVideo()">‚úï</span>
    <video id="modalVideo" controls autoplay></video>
  </div>
</div>

  <!-- Scripts -->
   <script src="js/script.js"></script>
  <script src="js/fetch-data.js"></script>

  <script>
    function formatRupiah(angka) {
      return "IDR " + angka.toLocaleString("id-ID");
    };

    function toggleWaMenu(event) {
      event.preventDefault();
      const menu = document.getElementById("waOptions");
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }

    function kirimPesan(pesan) {
      const link = `https://wa.me/${noHP}?text=${encodeURIComponent(pesan)}`;
      window.open(link, "_blank");
    }

    document.addEventListener("click", function (e) {
      const bubble = document.getElementById("waBubble");
      const menu = document.getElementById("waOptions");
      if (!bubble.contains(e.target)) {
        menu.style.display = "none";
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      const waBubble = document.getElementById("waBubble");
      const contactSection = document.getElementById("contact");

      if (contactSection && window.location.href.includes("#contact")) {
        waBubble.style.display = "none";
      }

      window.addEventListener("scroll", () => {
        const rect = contactSection.getBoundingClientRect();
        const isVisible = rect.top <= window.innerHeight && rect.bottom >= 0;
        waBubble.style.display = isVisible ? "none" : "block";
      });
      
      fetchProdukDariBackend();
    });
  
    // Load Dinamis dari Backend
    async function loadContentFromBackend() {
      const res = await fetch("https://obyshop-backend-production-4831.up.railway.app/api/content");
      const content = await res.json();

      if (content.heroTitle) document.getElementById("hero-title").innerHTML = content.heroTitle;
      if (content.heroSubtitle) document.getElementById("hero-subtitle").textContent = content.heroSubtitle;
      if (content.heroTitleColor) document.getElementById("hero-title").style.color = content.heroTitleColor;
      if (content.heroSubtitleColor) document.getElementById("hero-subtitle").style.color = content.heroSubtitleColor;
      if (content.heroBackgroundImage) {
        document.querySelector(".hero").style.backgroundImage = `url(https://obyshop-backend-production-4831.up.railway.app${content.heroBackgroundImage})`;
      }

      if (content.aboutText) document.getElementById("about-text").textContent = content.aboutText;

const root = document.documentElement;
// Tentang Kami - Load 3 video dan deskripsi
if (content.aboutVideos && Array.isArray(content.aboutVideos)) {
  content.aboutVideos.forEach((v, i) => {
    const wrapper = document.getElementById(`videoWrapper${i + 1}`);
    const titleEl = document.getElementById(`title${i + 1}`);
    const descEl = document.getElementById(`desc${i + 1}`);

    if (titleEl && v.title) titleEl.textContent = v.title;
    if (descEl && v.desc) descEl.textContent = v.desc;

    if (!wrapper || !v.videoUrl) return;

    wrapper.innerHTML = ""; // Kosongkan dulu kontennya

    if (v.videoUrl.startsWith("http") && v.videoUrl.includes("youtube.com")) {
      const iframe = document.createElement("iframe");
      iframe.src = v.videoUrl.replace("watch?v=", "embed/") + "?autoplay=0&mute=1";
      iframe.frameBorder = 0;
      iframe.allow = "autoplay; encrypted-media";
      iframe.allowFullscreen = true;
      iframe.style.width = "100%";
      iframe.style.aspectRatio = "16/9";
      wrapper.appendChild(iframe);
    } else {
      const video = document.createElement("video");
      video.src = v.videoUrl.startsWith("/") ? `https://obyshop-backend-production-4831.up.railway.app${v.videoUrl}` : v.videoUrl;
      video.controls = true;
      video.playsInline = true;
      video.muted = false;
      video.autoplay = false;
      video.style.width = "100%";
      wrapper.appendChild(video);
    }
  });
}

      if (content.contactInfo?.phone) {
        document.getElementById("contact-phone").textContent = content.contactInfo.phone;
        document.getElementById("contact-phone").href = `https://wa.me/${content.contactInfo.phone}`;
      }
      if (content.contactInfo?.email) {
        document.getElementById("contact-email").textContent = content.contactInfo.email;
        document.getElementById("contact-email").href = `mailto:${content.contactInfo.email}`;
      }
      if (content.contactInfo?.address) {
        document.getElementById("contact-address").textContent = content.contactInfo.address;
      }

    if (content.whatsapp?.bubbleButton) {
  whatsappBubbleNumber = content.whatsapp.bubbleButton; // simpan ke variabel global
  document.querySelector(".wa-bubble a").href = `https://wa.me/${whatsappBubbleNumber}`;
}

      if (content.whatsapp?.contactButton) {
        const cta = document.querySelector(".contact .cta");
        if (cta) cta.href = `https://wa.me/${content.whatsapp.contactButton}`;
      }

      if (content.socialMedia?.instagram) {
        document.querySelector(".socials .fa-instagram").parentElement.href = content.socialMedia.instagram;
      }
      if (content.socialMedia?.facebook) {
        document.querySelector(".socials .fa-facebook").parentElement.href = content.socialMedia.facebook;
      }
      if (content.socialMedia?.tiktok) {
        document.querySelector(".socials .fa-tiktok").parentElement.href = content.socialMedia.tiktok;
      }

      if (content.theme?.primaryColor) document.documentElement.style.setProperty("--primary", content.theme.primaryColor);
      if (content.theme?.backgroundColor) document.documentElement.style.setProperty("--bg", content.theme.backgroundColor);

    }

    loadContentFromBackend();
    
  async function fetchProdukDariBackend() {
    try {
      const res = await fetch("https://obyshop-backend-production-4831.up.railway.app/api/products");
      const allProduk = await res.json();
      const container = document.getElementById("produk-terbaru");
      container.innerHTML = "";

      // Ambil 1 produk per kategori
      const kategoriMap = {};
      allProduk.forEach((p) => {
        if (!kategoriMap[p.kategori]) {
          kategoriMap[p.kategori] = p;
        }
      });

      // Ambil 2 produk terbaru atau produk utama
      const terbaruUtama = allProduk
        .filter(p => p.produkBaru || p.produkUtama)
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .slice(0, 2);

      // Gabungkan, hilangkan duplikat
      const tampilkan = [...Object.values(kategoriMap), ...terbaruUtama].filter(
        (v, i, a) => a.findIndex(p => p._id === v._id) === i
      );

      tampilkan.forEach((p) => {
        const div = document.createElement("div");
        div.className = "menu-card";
        div.innerHTML = `
<img src="https://obyshop-backend-production-4831.up.railway.app/uploads/products/${p.imageFilename}" alt="${p.nama || p.name}" class="menu-card-img" />
<h3 class="menu-card-title">- ${p.nama || p.name} -</h3>
<p class="menu-card-price">Rp ${(p.harga || p.price).toLocaleString("id-ID")}</p>
<button onclick="addToCart('${p._id}', '${p.nama || p.name}', ${p.harga || p.price})">Tambah ke Keranjang</button>
        `;
        container.appendChild(div);
      });
    } catch (err) {
      console.error("‚ùå Gagal fetch produk dari backend:", err);
    }
  }

  function addToCart(id, nama, harga) {
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const index = cart.findIndex(item => item.id === id);

    if (index !== -1) {
      cart[index].qty += 1;
    } else {
      cart.push({ id, nama, harga, qty: 1 });
    }

    localStorage.setItem("cart", JSON.stringify(cart));
    alert("Produk ditambahkan ke keranjang!");
  }
// Modal Preview Video
function bukaModalVideo(src) {
  const modal = document.getElementById("videoModal");
  const video = document.getElementById("modalVideo");
  video.src = src;
  modal.style.display = "flex";
}

function tutupModalVideo() {
  const modal = document.getElementById("videoModal");
  const video = document.getElementById("modalVideo");
  modal.style.display = "none";
  video.pause();
  video.currentTime = 0;
}

// Tutup modal jika klik di luar video
document.getElementById("videoModal").addEventListener("click", function (e) {
  if (e.target === this) tutupModalVideo();
});
  </script>
</body>
</html>
